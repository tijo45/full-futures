{
  "feature": "Autonomous Futures Trading Bot",
  "workflow_type": "feature",
  "workflow_rationale": "Greenfield implementation of complete autonomous trading system with multiple interconnected components (IB integration, prediction engine, learning system, dashboard). Requires building from scratch with careful architectural planning for real-time performance and reliability.",
  "phases": [
    {
      "id": "phase-1-setup",
      "name": "Project Setup",
      "type": "setup",
      "description": "Create project structure, configuration, and dependencies",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create requirements.txt with all Python dependencies",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "requirements.txt"
          ],
          "patterns_from": [
            "spec.md Required Python Packages section"
          ],
          "verification": {
            "type": "command",
            "command": "cat requirements.txt && pip install -r requirements.txt --dry-run",
            "expected": "All packages listed and resolvable"
          },
          "status": "completed",
          "notes": "Created requirements.txt with all 9 Python dependencies: ib_async, river, dash, plotly, dash-bootstrap-components, pandas, numpy, pandas_market_calendars, aiohttp. File committed successfully.",
          "updated_at": "2026-01-12T17:04:31.235853+00:00"
        },
        {
          "id": "subtask-1-2",
          "description": "Create dynamic configuration module with environment variable support",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "config.py"
          ],
          "patterns_from": [
            "spec.md Development Environment section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from config import Config; c = Config(); print('IB_HOST:', c.IB_HOST, 'IB_PORT:', c.IB_PORT)\"",
            "expected": "IB_HOST: 127.0.0.1 IB_PORT: 7497"
          },
          "status": "completed",
          "notes": "Created config.py with dynamic configuration module. All settings loaded from environment variables with sensible defaults. Includes IB connection (host, port, client_id), dashboard settings, data integrity thresholds, session management, health monitoring, and logging configuration. Verification passed: IB_HOST: 127.0.0.1 IB_PORT: 7497",
          "updated_at": "2026-01-12T17:06:13.017185+00:00"
        },
        {
          "id": "subtask-1-3",
          "description": "Create directory structure with __init__.py files",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/__init__.py",
            "src/core/__init__.py",
            "src/data/__init__.py",
            "src/trading/__init__.py",
            "src/learning/__init__.py",
            "src/dashboard/__init__.py",
            "tests/__init__.py"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "python -c \"import src; import src.core; import src.data; import src.trading; import src.learning; import src.dashboard; print('OK')\"",
            "expected": "OK"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-2-ib-core",
      "name": "IB Client Foundation",
      "type": "implementation",
      "description": "Build the core IB async connection manager - foundation for all IB interactions",
      "depends_on": [
        "phase-1-setup"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create IBClient class with async connection management using ib_async",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/core/ib_client.py"
          ],
          "patterns_from": [
            "spec.md IB Async Connection Pattern section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.core.ib_client import IBClient; print('IBClient imported successfully')\"",
            "expected": "IBClient imported successfully"
          },
          "notes": "Must use ib_async (NOT ibapi), connectAsync(), unique clientId. Implement connection, disconnection, reconnection with exponential backoff.",
          "status": "pending"
        },
        {
          "id": "subtask-2-2",
          "description": "Create contract discovery module for auto-discovering tradeable futures",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/core/contract_discovery.py"
          ],
          "patterns_from": [
            "spec.md Contract Auto-Discovery requirement"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.core.contract_discovery import ContractDiscovery; print('ContractDiscovery imported successfully')\"",
            "expected": "ContractDiscovery imported successfully"
          },
          "notes": "Must discover futures contracts on startup. Use Future() NOT ContFuture() for real-time data. Prioritize by volume/liquidity.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-3-session",
      "name": "Session Management",
      "type": "implementation",
      "description": "Build exchange calendar and session handling for trading window awareness",
      "depends_on": [
        "phase-1-setup"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create session manager with pandas_market_calendars for exchange schedules",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/core/session_manager.py"
          ],
          "patterns_from": [
            "spec.md Session Management Pattern section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.core.session_manager import SessionManager; sm = SessionManager(); print('Calendars:', list(sm.calendars.keys()))\"",
            "expected": "Calendars: ['CME', 'CBOT', 'COMEX', 'NYMEX']"
          },
          "notes": "Must provide is_market_open(), minutes_to_close(), prevent entries near close, signal position exits before session end.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4-data",
      "name": "Market Data Layer",
      "type": "implementation",
      "description": "Build Level 1 and Level 2 market data handlers and feature extraction",
      "depends_on": [
        "phase-2-ib-core"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create market data handler for Level 1 and Level 2 data subscriptions",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/data/market_data.py"
          ],
          "patterns_from": [
            "spec.md IB Async Connection Pattern for reqMktData and reqMktDepth"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.data.market_data import MarketDataHandler; print('MarketDataHandler imported')\"",
            "expected": "MarketDataHandler imported"
          },
          "notes": "Must handle reqMktData() for L1, reqMktDepth() for L2 (domBids, domAsks). Track tick freshness for staleness detection.",
          "status": "pending"
        },
        {
          "id": "subtask-4-2",
          "description": "Create feature extraction engine for real-time feature generation",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/data/feature_engine.py"
          ],
          "patterns_from": [
            "River documentation - features must be dict format"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.data.feature_engine import FeatureEngine; fe = FeatureEngine(); print('FeatureEngine ready')\"",
            "expected": "FeatureEngine ready"
          },
          "notes": "CRITICAL: Output must be Python dict format for River, NOT numpy arrays. Include L1 and L2 derived features.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5-learning",
      "name": "Online Learning Foundation",
      "type": "implementation",
      "description": "Build River-based continuous learning system and drift detection",
      "depends_on": [
        "phase-4-data"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create online learner with River predict_one/learn_one pattern",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/learning/online_learner.py"
          ],
          "patterns_from": [
            "spec.md River Online Learning Pattern section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.learning.online_learner import OnlineLearner; ol = OnlineLearner(); print('OnlineLearner ready')\"",
            "expected": "OnlineLearner ready"
          },
          "notes": "CRITICAL: Use learn_one() NOT fit_one(). Features as dict. Include metrics tracking. Losses are first-class feedback signals.",
          "status": "pending"
        },
        {
          "id": "subtask-5-2",
          "description": "Create drift detector for market regime change detection using ADWIN",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/learning/drift_detector.py"
          ],
          "patterns_from": [
            "River drift.ADWIN documentation"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.learning.drift_detector import DriftDetector; dd = DriftDetector(); print('DriftDetector ready')\"",
            "expected": "DriftDetector ready"
          },
          "notes": "Use drift.ADWIN() for concept drift detection. Markets exhibit regime changes - must detect and signal for adaptation.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-prediction",
      "name": "Prediction Engine",
      "type": "implementation",
      "description": "Build prediction and confidence scoring system",
      "depends_on": [
        "phase-5-learning"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Create predictor module integrating features with online learner",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/trading/predictor.py"
          ],
          "patterns_from": [
            "src/learning/online_learner.py",
            "src/data/feature_engine.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.trading.predictor import Predictor; print('Predictor imported')\"",
            "expected": "Predictor imported"
          },
          "notes": "Coordinate feature extraction with online learner. Generate predictions with confidence scores in real-time.",
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Create confidence tracking and dynamic threshold management",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/trading/confidence.py"
          ],
          "patterns_from": [
            "spec.md Confidence-Gated Trading requirement"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.trading.confidence import ConfidenceTracker; ct = ConfidenceTracker(); print('ConfidenceTracker ready')\"",
            "expected": "ConfidenceTracker ready"
          },
          "notes": "Track confidence per prediction, per contract, per regime, over time. Dynamic thresholds - NO hard-coded values. Gate for entries, scaling, exits.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-trading",
      "name": "Trading Engine",
      "type": "implementation",
      "description": "Build order execution, position management, and risk optimization",
      "depends_on": [
        "phase-6-prediction",
        "phase-3-session"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Create confidence-gated order executor with IB integration",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/trading/executor.py"
          ],
          "patterns_from": [
            "src/core/ib_client.py",
            "src/trading/confidence.py"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.trading.executor import Executor; print('Executor imported')\"",
            "expected": "Executor imported"
          },
          "notes": "Only execute when confidence threshold met. Reject low-confidence signals. Track execution decisions for learning.",
          "status": "pending"
        },
        {
          "id": "subtask-7-2",
          "description": "Create position manager with authoritative order/position/exposure tracking",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/trading/position_manager.py"
          ],
          "patterns_from": [
            "spec.md Position Management requirement"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.trading.position_manager import PositionManager; pm = PositionManager(); print('PositionManager ready')\"",
            "expected": "PositionManager ready"
          },
          "notes": "Track all orders, positions, fills, exposure. Full reconciliation with IB at all times. Handle fill mismatches.",
          "status": "pending"
        },
        {
          "id": "subtask-7-3",
          "description": "Create risk manager with Sharpe optimization and drawdown protection",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/trading/risk_manager.py"
          ],
          "patterns_from": [
            "spec.md Risk Mitigation section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.trading.risk_manager import RiskManager; rm = RiskManager(); print('RiskManager ready')\"",
            "expected": "RiskManager ready"
          },
          "notes": "Optimize for Sharpe ratio. Handle rapid drawdown by increasing confidence threshold. Session-aware position sizing.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-8-health",
      "name": "Health Monitoring",
      "type": "implementation",
      "description": "Build system and data integrity watchdog",
      "depends_on": [
        "phase-2-ib-core",
        "phase-4-data"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-8-1",
          "description": "Create health monitor for connectivity, data freshness, and system stability",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/core/health_monitor.py"
          ],
          "patterns_from": [
            "spec.md Health Monitoring requirement"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.core.health_monitor import HealthMonitor; hm = HealthMonitor(); print('HealthMonitor ready')\"",
            "expected": "HealthMonitor ready"
          },
          "notes": "Monitor IB connectivity, data freshness (>30s = stale), system health. Halt trading on degradation, resume only on restoration.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-9-dashboard",
      "name": "Real-time Dashboard",
      "type": "implementation",
      "description": "Build Dash-based real-time visualization",
      "depends_on": [
        "phase-6-prediction",
        "phase-7-trading"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-9-1",
          "description": "Create Dash app entry point with dcc.Interval polling",
          "service": "dashboard",
          "files_to_modify": [],
          "files_to_create": [
            "src/dashboard/app.py"
          ],
          "patterns_from": [
            "spec.md Dash Real-time Update Pattern section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.dashboard.app import app; print('Dash app created')\"",
            "expected": "Dash app created"
          },
          "notes": "Use dcc.Interval(interval=1000) for 1-second updates. Consider dash-bootstrap-components for UI.",
          "status": "pending"
        },
        {
          "id": "subtask-9-2",
          "description": "Create dashboard layouts for all required panels",
          "service": "dashboard",
          "files_to_modify": [],
          "files_to_create": [
            "src/dashboard/layouts.py"
          ],
          "patterns_from": [
            "spec.md Browser Verification section for required panels"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.dashboard.layouts import create_layout; print('Layouts defined')\"",
            "expected": "Layouts defined"
          },
          "notes": "Panels: Confidence, Positions, P&L, Contracts, Training State, Performance Metrics (Sharpe, drawdown).",
          "status": "pending"
        },
        {
          "id": "subtask-9-3",
          "description": "Create real-time update callbacks for all dashboard components",
          "service": "dashboard",
          "files_to_modify": [],
          "files_to_create": [
            "src/dashboard/callbacks.py"
          ],
          "patterns_from": [
            "spec.md Dash Real-time Update Pattern section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.dashboard.callbacks import register_callbacks; print('Callbacks defined')\"",
            "expected": "Callbacks defined"
          },
          "notes": "Update all panels on interval. Downsample if performance issues. Show historical confidence, live training state.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-10-integration",
      "name": "System Integration",
      "type": "integration",
      "description": "Wire all components together in main orchestrator",
      "depends_on": [
        "phase-7-trading",
        "phase-8-health",
        "phase-9-dashboard"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-10-1",
          "description": "Create main.py orchestrator integrating all components",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "src/main.py"
          ],
          "patterns_from": [
            "spec.md Architecture Overview section"
          ],
          "verification": {
            "type": "command",
            "command": "python -c \"from src.main import main; print('Main orchestrator ready')\"",
            "expected": "Main orchestrator ready"
          },
          "notes": "Coordinate: IB connection -> contract discovery -> data subscription -> prediction loop -> execution. Async event loop.",
          "status": "pending"
        },
        {
          "id": "subtask-10-2",
          "description": "End-to-end integration verification with TWS connection",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Start TWS/Gateway on port 7497",
              "Run python src/main.py",
              "Verify IB connection established",
              "Verify contracts discovered",
              "Verify market data flowing",
              "Run python src/dashboard/app.py in separate terminal",
              "Open http://localhost:8050",
              "Verify all dashboard panels update"
            ]
          },
          "notes": "Full system integration test. All components must communicate correctly.",
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-11-tests",
      "name": "Test Suite",
      "type": "implementation",
      "description": "Create unit and integration tests",
      "depends_on": [
        "phase-10-integration"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-11-1",
          "description": "Create unit tests for core components",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "tests/test_ib_client.py",
            "tests/test_contract_discovery.py",
            "tests/test_session_manager.py",
            "tests/test_online_learner.py",
            "tests/test_confidence.py",
            "tests/test_position_manager.py"
          ],
          "patterns_from": [
            "spec.md QA Acceptance Criteria - Unit Tests"
          ],
          "verification": {
            "type": "command",
            "command": "pytest tests/ -v --tb=short",
            "expected": "All tests pass"
          },
          "status": "pending"
        },
        {
          "id": "subtask-11-2",
          "description": "Create integration tests for component interactions",
          "service": "trading-bot",
          "files_to_modify": [],
          "files_to_create": [
            "tests/integration/__init__.py",
            "tests/integration/test_market_data_flow.py",
            "tests/integration/test_prediction_pipeline.py",
            "tests/integration/test_trade_execution.py"
          ],
          "patterns_from": [
            "spec.md QA Acceptance Criteria - Integration Tests"
          ],
          "verification": {
            "type": "command",
            "command": "pytest tests/integration/ -v --tb=short",
            "expected": "All integration tests pass"
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 11,
    "total_subtasks": 21,
    "services_involved": [
      "trading-bot",
      "dashboard"
    ],
    "estimated_files": 28,
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-3-session"
          ],
          "reason": "Session management can be built in parallel with IB core after setup"
        },
        {
          "phases": [
            "phase-8-health",
            "phase-9-dashboard"
          ],
          "reason": "Health monitor and dashboard can be built in parallel once their dependencies complete"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential recommended due to component interdependencies"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 001 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration",
      "e2e"
    ],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All unit tests pass",
      "All integration tests pass",
      "Bot connects to IB TWS successfully",
      "Contract discovery works on startup",
      "Market data (L1 + L2) flows correctly",
      "Predictions generated with confidence scores",
      "Dashboard displays all required metrics",
      "Health monitoring halts on degradation",
      "No hard-coded values in production code"
    ],
    "verification_steps": [
      {
        "name": "Import Verification",
        "command": "python -c \"from src.main import main; print('All imports OK')\"",
        "expected_outcome": "All imports OK",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Unit Tests",
        "command": "pytest tests/ -v --tb=short",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Integration Tests",
        "command": "pytest tests/integration/ -v --tb=short",
        "expected_outcome": "All integration tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Dashboard Launch",
        "command": "timeout 5 python src/dashboard/app.py || true",
        "expected_outcome": "Dashboard starts on port 8050",
        "type": "manual",
        "required": true,
        "blocking": false
      }
    ],
    "reasoning": "High risk trading system requires comprehensive testing. Unit tests for business logic, integration tests for IB API interactions, E2E tests for complete trading workflows. Demo account serves as staging environment."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "pytest tests/"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "pytest tests/integration/"
      ],
      "services_to_test": [
        "trading-bot",
        "dashboard"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [],
      "flows": [
        "startup-discovery",
        "prediction-generation",
        "trade-lifecycle",
        "session-close",
        "disconnect-recovery"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:8050/",
          "checks": [
            "All panels render",
            "Data updates on interval",
            "No console errors"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": null,
  "created_at": "2026-01-12T14:30:00.000Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "updated_at": "2026-01-12T17:01:59.737Z",
  "recoveryNote": "Task recovered from stuck state at 2026-01-12T17:01:59.700Z",
  "last_updated": "2026-01-12T17:06:13.017197+00:00"
}