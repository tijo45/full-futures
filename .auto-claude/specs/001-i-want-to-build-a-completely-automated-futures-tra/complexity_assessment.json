{
  "complexity": "complex",
  "workflow_type": "feature",
  "confidence": 0.95,
  "reasoning": "This is a greenfield build of a complete autonomous trading system with zero existing code. Requires extensive IB API integration, real-time ML prediction engine, continuous learning system, multi-component architecture (7+ major subsystems), and safety-critical data integrity requirements. Multiple unfamiliar technologies and significant research needed.",

  "analysis": {
    "scope": {
      "estimated_files": 40,
      "estimated_services": 7,
      "is_cross_cutting": true,
      "notes": "Building from scratch: IB Integration Layer, Contract Discovery Engine, Prediction Engine, Continuous Learning System, Risk/Session Manager, Health Monitor, Real-time Dashboard. All components deeply interconnected."
    },
    "integrations": {
      "external_services": ["Interactive Brokers API", "IB TWS (Trader Workstation)", "Exchange Calendar Data"],
      "new_dependencies": ["ib_insync or ibapi", "pandas", "numpy", "asyncio", "dash or streamlit", "scikit-learn or pytorch"],
      "research_needed": true,
      "notes": "IB API is notoriously complex with callback-based architecture. Level 2 data handling, contract specifications, exchange calendars all require significant research. No existing patterns in codebase."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": true,
      "config_changes": true,
      "notes": "Will need persistent state management for orders, positions, predictions, and confidence tracking. Heavy .env configuration for IB credentials, connection settings, and operational parameters. May need SQLite or similar for state persistence."
    },
    "knowledge": {
      "patterns_exist": false,
      "research_required": true,
      "unfamiliar_tech": ["Interactive Brokers API", "Futures contract specifications", "Exchange calendars/sessions", "Real-time trading systems", "Market microstructure (Level 2 data)", "Online machine learning", "Sharpe ratio optimization"],
      "notes": "Empty codebase with no existing patterns. Must research IB API patterns, futures trading specifics, session management, real-time prediction architectures, and continuous learning approaches."
    },
    "risk": {
      "level": "high",
      "concerns": [
        "Data integrity failures could trigger unwanted trades",
        "IB connectivity issues during open positions",
        "Race conditions in order management",
        "Session timing errors causing position exposure",
        "State reconciliation between bot and IB",
        "Model instability causing erratic trading",
        "API credential security",
        "Resource exhaustion on Mac Ultra (80% usage target)"
      ],
      "notes": "Trading system is inherently high-risk. Even demo account, architecture must be production-quality to avoid learning bad patterns. Safety-critical requirements around data integrity and connectivity monitoring."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "self_critique",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": true,
    "needs_infrastructure_setup": true
  },

  "key_research_areas": [
    {
      "topic": "Interactive Brokers Python API",
      "reason": "Core integration - need to understand connection management, data streaming, order execution patterns",
      "priority": "critical"
    },
    {
      "topic": "Futures Contract Discovery & Specifications",
      "reason": "Must auto-discover tradeable contracts, understand tick sizes, margin requirements, session times",
      "priority": "critical"
    },
    {
      "topic": "IB Exchange Calendars & Session Management",
      "reason": "Autonomous session handling requires understanding of trading hours across all futures exchanges",
      "priority": "high"
    },
    {
      "topic": "Level 2 Market Data Processing",
      "reason": "Requirement to leverage order book data for modeling and execution decisions",
      "priority": "high"
    },
    {
      "topic": "Online/Continuous Learning Architectures",
      "reason": "System must adapt in real-time from trading results without full retraining",
      "priority": "high"
    },
    {
      "topic": "Real-time Dashboard Frameworks",
      "reason": "Need low-latency visualization of trading state, positions, P&L, confidence metrics",
      "priority": "medium"
    }
  ],

  "architectural_components": [
    {
      "name": "IB Integration Layer",
      "responsibility": "Connection management, data feed monitoring, order execution, state reconciliation",
      "estimated_files": 8
    },
    {
      "name": "Contract Discovery Engine",
      "responsibility": "Auto-identify tradeable futures, filter by liquidity/spread, maintain contract database",
      "estimated_files": 4
    },
    {
      "name": "Real-time Prediction Engine",
      "responsibility": "Fast inference, confidence scoring, opportunity ranking across contracts",
      "estimated_files": 6
    },
    {
      "name": "Continuous Learning System",
      "responsibility": "Online model updates, feedback from trades, regime detection, confidence calibration",
      "estimated_files": 6
    },
    {
      "name": "Risk & Session Manager",
      "responsibility": "Position sizing, exposure limits, session awareness, pre-close exits",
      "estimated_files": 5
    },
    {
      "name": "Health Monitor",
      "responsibility": "Connectivity watchdog, data freshness checks, training stability monitoring, alerting",
      "estimated_files": 4
    },
    {
      "name": "Real-time Dashboard",
      "responsibility": "Live visualization of all system state, P&L, metrics, confidence levels",
      "estimated_files": 5
    },
    {
      "name": "Core Infrastructure",
      "responsibility": "Configuration, logging, state persistence, utilities, main orchestration",
      "estimated_files": 6
    }
  ],

  "validation_recommendations": {
    "risk_level": "high",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scan_required": true,
    "staging_deployment_required": false,
    "reasoning": "Trading system handling financial transactions requires comprehensive testing. Unit tests for business logic, integration tests for IB API interactions, E2E tests for complete trading workflows. Security scan for API credential handling. Demo account serves as staging environment, so separate staging deployment not needed."
  },

  "implementation_warnings": [
    "IB API is callback-based and complex - expect learning curve",
    "Level 2 data can be high-volume - need efficient streaming architecture",
    "Real-time predictions with 80% resource usage requires careful optimization",
    "Session management across multiple exchanges is non-trivial",
    "State reconciliation with IB is critical for avoiding orphaned positions",
    "Must implement graceful shutdown to safely exit positions"
  ],

  "created_at": "2026-01-12T00:00:00Z"
}
